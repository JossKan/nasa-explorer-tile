<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NASA SpaceApp Challenge</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/estilos.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>

    <div id="app2">
        <!-- Bot√≥n hamburguesa -->
        <button id="btn-toggle" class="boton-hamburguesa">
            <span class="linea"></span>
            <span class="linea"></span>
            <span class="linea"></span>
        </button>

        <!-- DIV 1: Men√∫ lateral -->
        <div id="menu-lateral" class="cerrado">
            <!-- Bot√≥n cerrar dentro del men√∫ -->
            <button id="btn-cerrar" class="boton-cerrar">&times;</button>
            
            <h2>Men√∫</h2>
            <ul>
                <li><a href="index.html">Inicio</a></li>
                <li><a href="comparacion.html">Comparar</a></li>
                <li><button id="btnDescargar">Descargar como PNG</button></li>
            </ul>
        </div>

        <!-- Overlay oscuro -->
        <div id="overlay" class="overlay"></div>

        <!-- L√≠nea de tiempo fija - Siempre visible encima -->
        <div id="timeline-container-izq" class="timeline-container"></div>

        <!-- Bot√≥n para abrir panel de marcadores -->
        <button class="btn-toggle-marcadores" id="btn-toggle-marcadores">
            üìç
        </button>

        <!-- Panel de marcadores flotante -->
        <div class="panel-marcadores cerrado" id="panel-marcadores">
            <div class="panel-marcadores-header">
                <h3>Marcadores</h3>
                <button class="btn-cerrar-marcadores" id="btn-cerrar-marcadores">&times;</button>
            </div>
            <div class="panel-marcadores-contenido">
                <div class="marcadores-seccion">
                    <ul class="marcadores-lista" id="tag-list"></ul>
                </div>
            </div>
        </div>

        <!-- DIV 2: Visor de la luna -->
        <div id="visor-luna" style="background-color: black;">

        <div style="width: 100%;"id="app">
            <div style="width: 100%;" id="viewer"></div>

            <!-- Controles de zoom personalizados estilo Google Maps -->
            <div class="custom-zoom-controls">
                <button class="zoom-btn" id="zoom-in-viewer" title="Zoom in">+</button>
                <div class="zoom-separator"></div>
                <button class="zoom-btn" id="zoom-out-viewer" title="Zoom out">‚àí</button>
                <div class="zoom-separator"></div>
                <button class="zoom-btn zoom-reset" id="zoom-reset-viewer" title="Reset zoom">‚åÇ</button>
            </div>
        </div>
            <script src="https://cdn.jsdelivr.net/npm/openseadragon@4.1.0/build/openseadragon/openseadragon.min.js"></script>
            <script src="smfc/smfc1.js"></script>
            <script src="smfc/smfc3.js"></script>
            
            
        </div>
        
    </div>
    
    <script src="https://openseadragon.github.io/openseadragon/openseadragon.min.js"></script>
    <script src="smfc/script.js"></script>

    <script>


    document.getElementById('btnDescargar').addEventListener('click', function() {
        const fechaSeleccionada = window.obtenerTextoDelNodoActivo();

    html2canvas(document.getElementById('visor-luna')).then(function(canvas) {
        let ctx = canvas.getContext('2d');

        // üîπ Agrega texto encima de la imagen
        ctx.font = "16px Arial";
        ctx.fillStyle = "white";
        let fecha = new Date().toLocaleString();
        ctx.fillText("Fecha de descarga: " + fecha, 10, canvas.height - 20);
        ctx.fillText("Fuente: NASA", 10, canvas.height - 5);
        ctx.fillText("Fecha de la imagen: "+ fechaSeleccionada, 15, canvas.height - 40);

        let imgData = canvas.toDataURL('image/png');

        let link = document.createElement('a');
        link.href = imgData;
        link.download = `captura_${fecha.replace(/[:\/, ]/g, '-')}.png`;

        link.click();
    });
});
</script>

</body>
</html>