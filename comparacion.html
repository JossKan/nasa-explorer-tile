<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NASA SpaceApp Challenge</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/estilos.css">
    <link rel="stylesheet" href="css/comparacion.css">
    <script src="https://cdn.jsdelivr.net/npm/openseadragon@4.1.0/build/openseadragon/openseadragon.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>

    <div id="app2">
        <!-- Botón hamburguesa -->
        <button id="btn-toggle" class="boton-hamburguesa">
            <span class="linea"></span>
            <span class="linea"></span>
            <span class="linea"></span>
        </button>

        <!-- DIV 1: Menú lateral -->
        <div id="menu-lateral" class="cerrado">
            <button id="btn-cerrar" class="boton-cerrar">&times;</button>
            
            <h2>Menú</h2>
            <ul>
                <li><a href="index.html">Inicio</a></li>
                <li><a href="bienvenida.html">Salir de Comparación</a></li>
                <li><button id="btnDescargar">Descargar como PNG</button></li>
            </ul>
        </div>
        
        <!-- Overlay oscuro -->
        <div id="overlay" class="overlay"></div>

        <!-- Botón para abrir panel de marcadores -->
        <button class="btn-toggle-marcadores" id="btn-toggle-marcadores">
            📍
        </button>

        <!-- Panel de marcadores flotante -->
        <div class="panel-marcadores cerrado" id="panel-marcadores">
            <div class="panel-marcadores-header">
                <h3>Marcadores</h3>
                <button class="btn-cerrar-marcadores" id="btn-cerrar-marcadores">&times;</button>
            </div>
            <div class="panel-marcadores-contenido">
                <div class="marcadores-seccion">
                    <div class="marcadores-seccion-titulo">Visor Izquierdo</div>
                    <ul class="marcadores-lista" id="tag-list"></ul>
                </div>
                <div class="marcadores-seccion">
                    <div class="marcadores-seccion-titulo">Visor Derecho</div>
                    <ul class="marcadores-lista" id="tag-list2"></ul>
                </div>
            </div>
        </div>

       <div id="contenedor-comparacion">
    <!-- DIV 2: Visor imagen izquierda -->
    <div id="visor-izquierdo" class="visor">
        <div class="header-visor" id="header-izq">
            <span class="info-display" id="info-display-izq">Luna 1</span>
            <span class="icono-toggle">▼</span>
        </div>

        <div style="width: 100%;" id="app">
            <div style="width: 100%;" id="viewer"></div>

            <!-- Controles de zoom personalizados estilo Google Maps -->
            <div class="custom-zoom-controls">
                <button class="zoom-btn" id="zoom-in-viewer" title="Zoom in">+</button>
                <div class="zoom-separator"></div>
                <button class="zoom-btn" id="zoom-out-viewer" title="Zoom out">−</button>
                <div class="zoom-separator"></div>
                <button class="zoom-btn zoom-reset" id="zoom-reset-viewer" title="Reset zoom">⌂</button>
            </div>
        </div>

        <script src="smfc/smfc1.js"></script>
        
        <!-- Panel de fecha izquierdo -->
        <div class="panel-fecha oculto" id="panel-fecha-izq">
            <h3 class="titulo-fases">Fases de la Luna</h3>
            
            <!-- Botones de fases -->
            <div class="fases-lunares">
                <button class="btn-fase" data-fase="llena" data-visor="izq">
                    🌕 Llena
                </button>
                <button class="btn-fase" data-fase="nueva" data-visor="izq">
                    🌑 Nueva
                </button>
                <button class="btn-fase" data-fase="creciente" data-visor="izq">
                    🌓 Creciente
                </button>
                <button class="btn-fase" data-fase="menguante" data-visor="izq">
                    🌗 Menguante
                </button>
            </div>

            <!-- Dropdown de fechas específicas -->
            <div id="dropdown-fechas-izq" class="dropdown-fechas oculto">
                <select id="select-fechas-izq" class="select-fechas-fase">
                    <option value="">Selecciona una fecha de esta fase</option>
                </select>
            </div>

            <!-- Separador -->
            <div class="separador">o selecciona manualmente:</div>

            <!-- Selector normal -->
            <label for="fecha-izq">Selecciona fecha:</label>
            <input type="date" id="fecha-izq" class="selector-fecha" 
                   min="1986-01-15" max="2024-12-31">
            <input type="text" id="display-izq" class="display-fecha" readonly 
                   placeholder="Ninguna fecha seleccionada">

            <button id="btn-confirmar-izq" class="btn-confirmar">
                🚀Confirmar
            </button>
        </div>
    </div>

    <!-- DIV 3: Visor imagen derecha -->
    <div id="visor-derecho" class="visor">
        <div class="header-visor" id="header-der">
            <span class="info-display" id="info-display-der">Luna 2</span>
            <span class="icono-toggle">▼</span>
        </div>
        
        <div style="width: 100%;" id="app">
            <div style="width: 100%;" id="viewer2"></div>

            <!-- Controles de zoom personalizados estilo Google Maps -->
            <div class="custom-zoom-controls">
                <button class="zoom-btn" id="zoom-in-viewer2" title="Zoom in">+</button>
                <div class="zoom-separator"></div>
                <button class="zoom-btn" id="zoom-out-viewer2" title="Zoom out">−</button>
                <div class="zoom-separator"></div>
                <button class="zoom-btn zoom-reset" id="zoom-reset-viewer2" title="Reset zoom">⌂</button>
            </div>
        </div>

        <script src="smfc/smfc2.js"></script>
        
        <!-- Panel de fecha derecho -->
        <div class="panel-fecha oculto" id="panel-fecha-der">
            <h3 class="titulo-fases">Fases de la Luna</h3>
            
            <!-- Botones de fases -->
            <div class="fases-lunares">
                <button class="btn-fase" data-fase="llena" data-visor="der">
                    🌕 Llena
                </button>
                <button class="btn-fase" data-fase="nueva" data-visor="der">
                    🌑 Nueva
                </button>
                <button class="btn-fase" data-fase="creciente" data-visor="der">
                    🌓 Creciente
                </button>
                <button class="btn-fase" data-fase="menguante" data-visor="der">
                    🌗 Menguante
                </button>
            </div>

            <!-- Dropdown de fechas específicas -->
            <div id="dropdown-fechas-der" class="dropdown-fechas oculto">
                <select id="select-fechas-der" class="select-fechas-fase">
                    <option value="">Selecciona una fecha de esta fase</option>
                </select>
            </div>

            <!-- Separador -->
            <div class="separador">o selecciona manualmente:</div>

            <!-- Selector normal -->
            <label for="fecha-der">Selecciona fecha:</label>
            <input type="date" id="fecha-der" class="selector-fecha" 
                   min="1986-01-15" max="2024-12-31">
            <input type="text" id="display-der" class="display-fecha" readonly 
                   placeholder="Ninguna fecha seleccionada">
            <button id="btn-confirmar-der" class="btn-confirmar">
                🚀Confirmar
            </button>
        </div>
    </div>
</div> 

    <script src="https://openseadragon.github.io/openseadragon/openseadragon.min.js"></script>
    <script src="smfc/script.js"></script>
    <script src="smfc/fechas.js"></script>
    <script src="smfc/fases-lunares.js"></script>

    <script>

    document.getElementById('btnDescargar').addEventListener('click', function() {
    html2canvas(document.getElementById('contenedor-comparacion')).then(function(canvas) {
        let ctx = canvas.getContext('2d');

        // 🔹 Agrega texto encima de la imagen
        ctx.font = "16px Arial";
        ctx.fillStyle = "white";
        let fecha = new Date().toLocaleString();
        ctx.fillText("Fecha de descarga: " + fecha, 28, canvas.height - 20);
        ctx.fillText("Fuente: NASA", 28, canvas.height - 5);

        ctx.fillText("Fecha de descarga: " + fecha, 725, canvas.height - 20);
        ctx.fillText("Fuente: NASA", 725, canvas.height - 5);

        let imgData = canvas.toDataURL('image/png');

        let link = document.createElement('a');
        link.href = imgData;
        link.download = `captura_${fecha.replace(/[:\/, ]/g, '-')}.png`;

        link.click();
    });
});
</script>

</body>
</html>